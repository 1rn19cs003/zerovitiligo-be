generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Doctor {
  id             String           @id @default(uuid())
  name           String
  email          String           @unique
  password       String
  role           DoctorRole       @default(ASSISTANT)
  createdAt      DateTime         @default(now())
  assistants     Assistant[]      @relation("DoctorAssistants")
  patients       Patient[]
  PatientHistory PatientHistory[]
}

model Assistant {
  id             String           @id @default(uuid())
  name           String
  email          String           @unique
  password       String
  doctorId       String
  createdAt      DateTime         @default(now())
  doctor         Doctor           @relation("DoctorAssistants", fields: [doctorId], references: [id])
  patients       Patient[]
  PatientHistory PatientHistory[]
}

model Patient {
  id         String  @id @default(uuid())
  patientId  String  @unique
  name       String
  age        Int
  mobile     String  @unique
  bodyWeight Float?
  address    String?

  state     String?

  vitiligoDuration String?
  currentMedicine  String?
  covidVaccine     String?
  vaccineDoses     Int?

  // Disease-related fields updated
  hasDisease     String?
  diseaseDetails String?

  familyHistory String?
  status        Status   @default(NEW_REGISTRATION)
  doctorId      String?
  assistantId   String?
  createdAt     DateTime @default(now())

  // Relations
  images    Image[]
  assistant Assistant?       @relation(fields: [assistantId], references: [id])
  doctor    Doctor?          @relation(fields: [doctorId], references: [id])
  histories PatientHistory[]
}

model Image {
  id         String   @id @default(uuid())
  url        String
  patientId  String
  uploadedAt DateTime @default(now())
  patient    Patient  @relation(fields: [patientId], references: [id])
}

model PatientHistory {
  id             String     @id @default(uuid())
  patientId      String
  doctorId       String?
  assistantId    String?
  lastMedicine   String?
  adviceGiven    String?
  lastInspection DateTime
  nextInspection DateTime?
  createdAt      DateTime   @default(now())
  assistant      Assistant? @relation(fields: [assistantId], references: [id])
  doctor         Doctor?    @relation(fields: [doctorId], references: [id])
  patient        Patient    @relation(fields: [patientId], references: [id])
}

enum DoctorRole {
  ADMIN
  ASSISTANT
}

enum Status {
  NEW_REGISTRATION // Patient just registered, no doctor assigned yet
  UNDER_DIAGNOSIS // Doctor/assistant is inspecting or evaluating
  UNDER_TREATMENT // Actively receiving treatment
  TREATMENT_COMPLETED // Treatment completed, patient recovered or discharged
  FOLLOW_UP // Under observation or periodic review
}
