generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Doctor {
  id             String           @id @default(uuid())
  name           String
  email          String           @unique
  password       String
  role           DoctorRole       @default(ASSISTANT)
  mobile         String?
  createdAt      DateTime         @default(now())
  patients       Patient[]

  Appointment Appointment[]
}

model Patient {
  id         String  @id @default(uuid())
  patientId  String  @unique
  name       String
  age        Int
  mobile     String  @unique
  bodyWeight Float?
  address    String?

  state String?

  vitiligoDuration String?
  currentMedicine  String?
  vaccineDoses     String?

  // Disease-related fields updated
  hasDisease     String?
  diseaseDetails String?

  familyHistory String?
  status        Status   @default(NEW_REGISTRATION)
  doctorId      String?
  assistantId   String?
  createdAt     DateTime @default(now())

  // Relations
  images    Image[]
  doctor    Doctor?          @relation(fields: [doctorId], references: [id])

  Appointment Appointment[]
}

model Image {
  id         String   @id @default(uuid())
  url        String
  patientId  String
  uploadedAt DateTime @default(now())
  patient    Patient  @relation(fields: [patientId], references: [id])
}

model Appointment {
  id              String            @id @default(uuid())
  doctorId        String
  patientId       String
  appointmentDate DateTime
  startTime       DateTime
  endTime         DateTime?
  reason          String?
  medication      String?
  status          AppointmentStatus @default(SCHEDULED)
  notes           String?

  // Relations
  doctor  Doctor  @relation(fields: [doctorId], references: [id])
  patient Patient @relation(fields: [patientId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum AppointmentStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  MISSED
}

enum DoctorRole {
  ADMIN
  ASSISTANT
}

enum Status {
  NEW_REGISTRATION // Patient just registered, no doctor assigned yet
  UNDER_DIAGNOSIS // Doctor/assistant is inspecting or evaluating
  UNDER_TREATMENT // Actively receiving treatment
  TREATMENT_COMPLETED // Treatment completed, patient recovered or discharged
  FOLLOW_UP // Under observation or periodic review
  BLOCKED // Under observation or periodic review
}
